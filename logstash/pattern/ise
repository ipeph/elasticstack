# ### Cisco ISE Pattern by Febry Citra Prawira Negara
# ### September 2021

# Common Particles
ISE_ACTION Tacacs\-Accounting|Failed\-Attempt|Passed\-Authentication|Device\-Administration|RADIUS|null(?:%{WORD}\s*)*
ISE_STATUS TACACS\+ Accounting START|TACACS\+ Accounting STOP|TACACS\+ Accounting with Command|Authentication failed|Authentication succeeded|Session Authorization succeeded|Command Authorization succeeded|Command Authorization failed|TACACS\+ Accounting request rejected|Supplicant stopped responding to ISE|MnT purge event occurred|Previously rejected endpoint was released to continue authentications|(?:%{WORD}\s*)*

# ISE Pattern

# ISE TAC Accounting
ISETACACC %{GREEDYDATA:unused} %{ISE_ACTION:ise_action}: %{ISE_STATUS:ise_status}, ConfigVersionId=%{INT:configversionid}, Device IP Address=%{IP:device_ip}, ?(CmdSet=\[ %{GREEDYDATA:command_set} \],)? RequestLatency=%{INT:request_latency}, NetworkDeviceName=%{DATA:network_device_name}, Type=%{DATA:service_type}, ?(Privilege-Level=%{INT:privilege_level}, Service=%{DATA:service}, User=%{DATA:user})??(, Port=%{DATA:port})??(, Remote-Address=%{DATA:src_ip}, Authen-Method=%{DATA:method},)? %{GREEDYDATA:unused}, ?(NetworkDeviceGroups=Location#All Locations?(#%{DATA:location})?, NetworkDeviceGroups=Device Type#All Device Types?(#%{DATA:type})?)? ?(NetworkDeviceGroups=Device Type#All Device Types#%{DATA:type}, %{GREEDYDATA:unused}, NetworkDeviceGroups=Location#All Locations#%{DATA:location})? ?(NetworkDeviceGroups=Device Type#All Device Types#%{DATA:type}, NetworkDeviceGroups=Location#All Locations#%{DATA:location})?, %{GREEDYDATA:unused}

# ISE TAC Failed-Attempt
ISETACFAILED %{GREEDYDATA:unused} %{ISE_ACTION:ise_action}: %{ISE_STATUS:ise_status}, ConfigVersionId=%{INT:configversionid}, Device IP Address=%{IP:device_ip}, ?(Device Port=%{INT:device_port},)? DestinationIPAddress=%{IP:ise_ip}, ?(DestinationPort=%{INT:ise_port},)? ?(UserName=%{DATA:user},)? ?(CmdSet=\[ %{GREEDYDATA:command_set} \],)? ?(Protocol=%{DATA:protocol}, RequestLatency=%{INT:request_latency}, NetworkDeviceName=%{DATA:network_device_name}, Type=%{DATA:service_type},)? ?(Action=%{DATA:action},)? ?(Privilege-Level=%{INT:privilege_level},)? ?(%{GREEDYDATA:unused}, Remote-Address=%{DATA:src_ip},)? %{GREEDYDATA:unused}, FailureReason=%{DATA:failure_reason}, %{GREEDYDATA:unused}, ?(NetworkDeviceGroups=Location#All Locations?(#%{DATA:location})?, NetworkDeviceGroups=Device Type#All Device Types?(#%{DATA:type})?)?, %{GREEDYDATA:unused}

# ISE TAC Device-Administration | | Passed-Attempt
ISETACDEVADMIN %{GREEDYDATA:unused} %{ISE_ACTION:ise_action}: %{ISE_STATUS:ise_status}, ConfigVersionId=%{INT:configversionid}, Device IP Address=%{IP:device_ip}, DestinationIPAddress=%{IP:ise_ip}, DestinationPort=%{INT:ise_port}, UserName=%{DATA:user}, ?(CmdSet=\[ %{GREEDYDATA:command_set} \],)? Protocol=%{DATA:protocol}, ?(MatchedCommandSet=%{DATA:matched_command_set},)? RequestLatency=%{INT:request_latency}, NetworkDeviceName=%{DATA:network_device_name}, Type=%{DATA:service_type},?( Action=%{DATA:action},)? Privilege-Level=%{INT:privilege_level}, Authen-Type=%{DATA:auth_type}, ?(%{GREEDYDATA:unused}, Port=%{DATA:terminal_port}, Remote-Address=%{DATA:src_ip},)? ?(%{GREEDYDATA:unused}, Port=%{DATA:terminal_port},)? ?(%{GREEDYDATA:unused}, Remote-Address=%{DATA:src_ip},)? ?(%{GREEDYDATA:unused}, NetworkDeviceGroups=Location#All Locations#%{DATA:location}, NetworkDeviceGroups=Device Type#All Device Types#%{DATA:type}, %{GREEDYDATA:unused})?

# ISE WLC Pattern

# ISE WLC Command
ISEWLCCMD %{GREEDYDATA:unused} %{ISE_ACTION:ise_action}: %{ISE_STATUS:ise_status}, ConfigVersionId=%{INT:configversionid}, Device IP Address=%{IP:device_ip}, CmdSet=\[ %{GREEDYDATA:command_set} \], RequestLatency=%{INT:request_latency}, NetworkDeviceName=%{DATA:network_device_name}, Type=%{DATA:service_type}, Privilege-Level=%{INT:privilege_level}, Service=%{DATA:service}, User=%{DATA:user}, Remote-Address=%{DATA:src_ip}, Authen-Method=%{DATA:method}, %{GREEDYDATA:unused}, NetworkDeviceGroups=Device Type#All Device Types#%{DATA:type}, %{GREEDYDATA:unused}, NetworkDeviceGroups=Location#%{DATA:location}, %{GREEDYDATA:unused}

# ISE WLC Auth
ISEWLCAUTH %{GREEDYDATA:unused} %{GREEDYDATA:ise_action}: %{GREEDYDATA:ise_status}, ConfigVersionId=%{INT:configversionid}, Device IP Address=%{IP:device_ip}, ?(Device Port=%{INT:device_port},)? DestinationIPAddress=%{IP:ise_ip}, DestinationPort=%{INT:ise_port}, UserName=%{DATA:user}, Protocol=%{DATA:protocol}, RequestLatency=%{INT:request_latency}, NetworkDeviceName=%{DATA:network_device_name}, Type=%{DATA:service_type}, Action=%{DATA:action}, Privilege-Level=%{INT:privilege_level}, %{GREEDYDATA:unused}, Remote-Address=%{DATA:src_ip}, %{GREEDYDATA:unused}, NetworkDeviceGroups=Device Type#All Device Types#%{DATA:type}, %{GREEDYDATA:unused}, NetworkDeviceGroups=Location#All Locations#%{DATA:location}, %{GREEDYDATA:unused}

# ISE RAD Failed-Attempt
ISERADFAILED %{GREEDYDATA:unused} %{ISE_ACTION:ise_action}: %{ISE_STATUS:ise_status}, ConfigVersionId=%{INT:configversionid}, Device IP Address=%{IP:device_ip}, ?(Device Port=%{INT:device_port},)? DestinationIPAddress=%{IP:ise_ip}, ?(DestinationPort=%{INT:ise_port},)? ?(UserName=%{DATA:user},)? ?(CmdSet=\[ %{GREEDYDATA:command_set} \],)? ?(Protocol=%{DATA:protocol}, RequestLatency=%{INT:request_latency}, NetworkDeviceName=%{DATA:network_device_name}, Type=%{DATA:service_type},)? ?(Action=%{DATA:action},)? ?(Privilege-Level=%{INT:privilege_level},)? ?(%{GREEDYDATA:unused}, Remote-Address=%{DATA:src_ip},)? %{GREEDYDATA:unused}, FailureReason=%{DATA:failure_reason}, %{GREEDYDATA:unused}, ?(NetworkDeviceGroups=Location#All Locations#%{DATA:location}, NetworkDeviceGroups=Device Type#All Device Types#%{DATA:type})?, %{GREEDYDATA:unused}

# RADIUS: Previously rejected endpoint was released to continue authentications
ISERADREJ %{GREEDYDATA:unused} %{ISE_ACTION:ise_action}: %{ISE_STATUS:ise_status}, ConfigVersionId=%{INT:configversionid}, Protocol=%{DATA:protocol}, %{GREEDYDATA:unused}

# ISE RAD Authentication Failed-Attempt | Passed Attempt
ISERADAUTH %{GREEDYDATA:unused} %{ISE_ACTION:ise_action}: %{ISE_STATUS:ise_status}, ConfigVersionId=%{INT:configversionid}, ?(RadiusPacketType=%{DATA:radius_packet_type},)? Device IP Address=%{IP:device_ip}, ?(Device Port=%{INT:device_port},)? DestinationIPAddress=%{IP:ise_ip}, ?(DestinationPort=%{INT:ise_port},)? ?(RadiusPacketType=%{DATA:radius_packet_type},)? UserName=%{DATA:user}, ?(%{GREEDYDATA:unused}, FailureReason=%{DATA:failure_reason})??(Protocol=%{DATA:protocol}, RequestLatency=%{INT:request_latency}, NetworkDeviceName=%{DATA:network_device_name}, User-Name=%{GREEDYDATA:domain_user}, NAS-IP-Address=%{IP:nas_ip}, NAS-Port=%{INT:nas_port}, %{GREEDYDATA:unused}, Called-Station-ID=%{GREEDYDATA:called_station_id}:%{GREEDYDATA:ssid_name}:%{GREEDYDATA:ap_name}, Calling-Station-ID=%{GREEDYDATA:unused})? ?(%{GREEDYDATA:unused}, NetworkDeviceName=%{DATA:network_device_name}, NetworkDeviceGroups=Device Type#All Device Types#%{DATA:type}, NetworkDeviceGroups=IPSEC#Is IPSEC Device#No, NetworkDeviceGroups=Location#All Locations#%{DATA:location})?, ?(%{DATA:unused} User-Name=%{GREEDYDATA:domain_user}, NAS-IP-Address=%{IP:nas_ip}, NAS-Port=%{INT:nas_port}, Called-Station-ID=%{GREEDYDATA:called_station_id}:%{GREEDYDATA:ssid_name}:%{GREEDYDATA:ap_name}, Calling-Station-ID=%{GREEDYDATA:unused})?%{GREEDYDATA:unused}

# ISE EVENT
ISEEVENT %{GREEDYDATA:unused} %{ISE_ACTION:ise_action}: %{ISE_STATUS:ise_status}, MESSAGE=%{GREEDYDATA:event_msg}
